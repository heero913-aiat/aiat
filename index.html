<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Learn Your Way: AI ì¦ê°• êµê³¼ì„œ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Gowun+Dodum&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Gowun Dodum', sans-serif;
            background-color: #f0f9ff;
        }
        .setup-card {
            background-color: white;
            border-radius: 24px;
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.05),
                        0 8px 10px -6px rgb(0 0 0 / 0.05);
            border: 1px solid #e0f2fe;
            padding: 2.5rem;
        }
        .cute-input {
            border-radius: 12px;
            border-width: 2px;
            border-color: #e5e7eb;
            padding: 0.75rem 1rem;
            transition: all 0.2s ease-in-out;
        }
        .cute-input:focus {
            border-color: #fb7185;
            box-shadow: 0 0 0 3px rgb(251 113 133 / 0.2);
            outline: none;
        }
        .cute-button {
            border-radius: 12px;
            font-weight: 700;
            padding: 0.75rem 1rem;
            transition: transform 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1),
                        0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        .cute-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1),
                        0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
        .tab-btn { border-bottom-width: 4px; border-color: transparent; color: #6b7280; transition: all 0.2s; }
        .tab-btn.active { border-color: #38bdf8; color: #0c4a6e; font-weight: 700; }
        .quiz-option { border-radius: 12px; border-width: 2px; }
        .quiz-option:hover { border-color: #a5b4fc; background-color: #f0f9ff; }
        .quiz-option.selected { border-color: #38bdf8; background-color: #7dd3fc; }
        .quiz-option.correct { border-color: #34d399; background-color: #a7f3d0; }
        .quiz-option.incorrect { border-color: #fb7185; background-color: #fecdd3; }
        .prose { font-size: 1.125rem; line-height: 1.8; }
    </style>
</head>
<body class="text-slate-800">

    <!-- ì´ˆê¸° ì„¤ì • í™”ë©´ -->
    <div id="setup-screen" class="min-h-screen flex items-center justify-center p-4">
        <div class="w-full max-w-lg setup-card">
            <div class="text-center">
                <h1 class="text-4xl font-bold text-sky-800">Learn Your Way ğŸš€</h1>
                <p class="mt-2 text-slate-500">AIì™€ í•¨ê»˜ ë‚˜ë§Œì˜ êµê³¼ì„œë¥¼ ë§Œë“¤ì–´ ë³´ì„¸ìš”.</p>
            </div>
            <div class="mt-8 space-y-6">
                <div>
                    <label for="grade-level" class="block text-sm font-medium text-slate-700">í•™ë…„</label>
                    <select id="grade-level" class="mt-1 block w-full cute-input">
                        <option value="ì´ˆë“±í•™êµ 3í•™ë…„" selected>ì´ˆë“±í•™êµ 3í•™ë…„</option>
                        <option value="ì´ˆë“±í•™êµ 4í•™ë…„">ì´ˆë“±í•™êµ 4í•™ë…„</option>
                        <option value="ì´ˆë“±í•™êµ 5í•™ë…„">ì´ˆë“±í•™êµ 5í•™ë…„</option>
                        <option value="ì´ˆë“±í•™êµ 6í•™ë…„">ì´ˆë“±í•™êµ 6í•™ë…„</option>
                    </select>
                </div>
                <div>
                    <label for="interests" class="block text-sm">ê´€ì‹¬ì‚¬</label>
                    <input type="text" id="interests" class="mt-1 block w-full cute-input" placeholder="ì˜ˆ: ê²Œì„, ê³µë£¡">
                </div>
                <div>
                    <label for="topic-input" class="block text-sm">í•™ìŠµ ì£¼ì œ</label>
                    <input type="text" id="topic-input" class="mt-1 block w-full cute-input" placeholder="ì˜ˆ: ì„¸ì¢…ëŒ€ì™•">
                </div>
                <div>
                    <label for="voice-persona" class="block text-sm">AI í˜ë¥´ì†Œë‚˜</label>
                    <select id="voice-persona" class="mt-1 block w-full cute-input">
                        <option value="ì¹œì ˆí•œ ì„ ìƒë‹˜">ğŸ‘©â€ğŸ« ì¹œì ˆí•œ ì„ ìƒë‹˜</option>
                        <option value="í™œê¸°ì°¬ ì•„ì´ëŒ">ğŸ¤ í™œê¸°ì°¬ ì•„ì´ëŒ</option>
                        <option value="ì°¨ë¶„í•œ ë¶„ì„ê°€">ğŸ§ ì°¨ë¶„í•œ ë¶„ì„ê°€</option>
                    </select>
                </div>
            </div>
            <div class="mt-8">
                <button id="start-learning-btn" class="w-full bg-sky-500 text-white cute-button text-lg">
                    ë‚˜ë§Œì˜ êµê³¼ì„œ ë§Œë“¤ê¸°
                </button>
            </div>
        </div>
    </div>

    <!-- ë¡œë”© -->
    <div id="loading-overlay" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50 hidden opacity-0">
        <p id="loading-message" class="text-white">AIê°€ ìë£Œë¥¼ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤...</p>
    </div>

    <!-- ë©”ì¸ -->
    <div id="main-app-screen" class="hidden p-6">
        <h1 id="app-title" class="text-3xl font-bold text-sky-800">Learn Your Way ğŸš€</h1>
        <div id="immersive-text-content" class="prose mt-6"></div>
    </div>

    <script type="module">
        const setupScreen = document.getElementById('setup-screen');
        const mainAppScreen = document.getElementById('main-app-screen');
        const startLearningBtn = document.getElementById('start-learning-btn');
        const loadingOverlay = document.getElementById('loading-overlay');
        const loadingMessage = document.getElementById('loading-message');
        const gradeLevelSelect = document.getElementById('grade-level');
        const interestsInput = document.getElementById('interests');
        const topicInput = document.getElementById('topic-input');
        const voicePersonaSelect = document.getElementById('voice-persona');
        const immersiveTextContainer = document.getElementById('immersive-text-content');

        let userProfile = {};

        // âœ… API í˜¸ì¶œ í•¨ìˆ˜ (ì¤‘ë³µ/ì—ëŸ¬ ì œê±°ëœ ë²„ì „)
        async function callGemini(prompt, systemInstruction, isJson = false) {
            const parts = [{ text: prompt }];
            let payload = {
                contents: [{ parts }],
                systemInstruction: { parts: [{ text: systemInstruction }] }
            };
            if (isJson) {
                payload.generationConfig = { responseMimeType: "application/json" };
            }
            try {
                const response = await fetch("/api/gemini", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(payload),
                });
                if (!response.ok) throw new Error("API ìš”ì²­ ì‹¤íŒ¨: " + response.status);
                const result = await response.json();
                return result?.candidates?.[0]?.content?.parts?.[0]?.text || "ì‘ë‹µ ì—†ìŒ";
            } catch (error) {
                console.error("Gemini API í˜¸ì¶œ ì¤‘ ì˜¤ë¥˜:", error);
                return isJson ? '{}' : `ì—ëŸ¬ ë°œìƒ: ${error.message}`;
            }
        }

        // ë²„íŠ¼ ì´ë²¤íŠ¸
        startLearningBtn.addEventListener('click', async () => {
            const topicValue = topicInput.value.trim();
            if (!topicValue) {
                alert("í•™ìŠµ ì£¼ì œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!");
                return;
            }

            userProfile = {
                grade: gradeLevelSelect.value,
                interests: interestsInput.value || "ë‹¤ì–‘í•œ ë¶„ì•¼",
                topic: topicValue,
                persona: voicePersonaSelect.value
            };

            setupScreen.classList.add('hidden');
            loadingOverlay.classList.remove('hidden');
            loadingMessage.textContent = `AIê°€ '${userProfile.topic}'ì— ëŒ€í•œ í•™ìŠµ ìë£Œë¥¼ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤...`;

            const baseTextSystemInstruction = "You are an expert curriculum developer for elementary school students. Respond in Korean.";
            const baseText = await callGemini(userProfile.topic, baseTextSystemInstruction);

            immersiveTextContainer.innerHTML = `<h2>${userProfile.topic}</h2><p>${baseText}</p>`;
            loadingOverlay.classList.add('hidden');
            mainAppScreen.classList.remove('hidden');
        });
    </script>
</body>
</html>
